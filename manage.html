<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Debate Dictionaries</title>
  <style>
    /* Same pleasant design */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Arial", sans-serif;
      background: linear-gradient(to right, #fbe7e7, #ffdcdc);
      text-align: center;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background-color: #ffffffdd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: left; /* We'll keep content left-aligned inside for clarity */
    }
    h1 {
      color: #ff5c5c;
      margin-bottom: 20px;
      text-align: center;
    }
    label, select, input, button {
      display: block;
      margin: 0.5rem 0;
    }
    button {
      background-color: #ff8585;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #e06b6b;
    }
    #dictionaryDisplay {
      margin-top: 1rem;
      padding: 0.5rem;
      background-color: #fff;
      border-radius: 4px;
      min-height: 50px;
    }
    .note {
      font-style: italic;
      color: #666;
      margin: 5px 0 10px;
    }
    hr {
      margin: 2rem 0;
      border: none;
      height: 1px;
      background-color: #ddd;
    }
    #errorMsg {
      margin-top: 1rem;
      color: red;
      font-weight: bold;
    }
    .back-link {
      margin-top: 30px;
      display: block;
      color: #fff;
      background-color: #ff8585;
      padding: 10px;
      width: 200px;
      margin: 30px auto 0;
      text-align: center;
      border-radius: 6px;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    .back-link:hover {
      background-color: #e06b6b;
    }
  </style>
</head>
<body>
  <h1>Manage Dictionaries</h1>
  <div class="container">

    <!-- 1) SHOW DICTIONARIES -->
    <button id="showDictionariesBtn">Show Dictionaries</button>
    <div id="dictionaryDisplay"></div>
    <div id="errorMsg"></div>

    <hr />

    <!-- 2) ADD WORDS -->
    <h2>Add Words</h2>
    <label for="newWords">Enter words (comma separated):</label>
    <input type="text" id="newWords" placeholder="Mr. Bean, אבוקדו" />

    <label for="autoDetect">Language detection:</label>
    <input type="checkbox" id="autoDetect" checked />
    <span class="note">If checked, we guess the language by looking for Hebrew characters.</span>

    <label for="languageSelect">If not auto-detect, pick dictionary to update:</label>
    <select id="languageSelect">
      <option value="english">English</option>
      <option value="hebrew">Hebrew</option>
    </select>
    <button id="addWordsBtn">Add Words</button>

  </div>

  <!-- Link back to index.html -->
  <a href="index.html" class="back-link">Back to Game</a>

  <!-- Firebase (Modular) -->
  <script type="module">
    /**************************************
     * 1) IMPORT FIREBASE (MODULAR)      *
     **************************************/
    import { 
      initializeApp 
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";

    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      updateDoc,
      arrayUnion
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    /**************************************
     * 2) FIREBASE CONFIG + INIT          *
     **************************************/
    const firebaseConfig = {
      apiKey: "AIzaSyAayialkEZsC7rdYIm4k6lix4NLQZP9Qqg",
      authDomain: "debategametechnion.firebaseapp.com",
      projectId: "debategametechnion",
      storageBucket: "debategametechnion.firebasestorage.app",
      messagingSenderId: "1000572030639",
      appId: "1:1000572030639:web:03f74e9c4006ba2e198e5a",
      measurementId: "G-32MCCNDGFT"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /**************************************
     * 3) DEFAULT WORD ARRAYS             *
     **************************************/
    const defaultEnglishWords = [
      "Mr. Bean", "flamingo", "eggplant", "gorilla", "banana",
      "chess", "testicle", "pizza", "watermelon", "unicorn",
      "junky", "flat earth", "pancake", "Love Poem", "Simha Rotman", 
      "Simba", "Gigolo"
    ];
    
    const defaultHebrewWords = [
      "משוגע", "קרפיון", "שזלונג", "מעבורת חלל", "אבוקדו קשה",
      "חציל", "מחשבטור", "חמודי", "רטוב", "פינגווין",
      "קופים ארקטים", "קישוא", "תות", "דודו פארוק",
      "אשך", "שחלה", "וריקוצלה", "ציפורן חודרנית", "דיברגנץ",
      "הונלולו", "עכוז", "משגל", "ברוקלין 99", "כדילהלן",
      "נומינלי", "מריונטה", "הדיוטות", "תלתלים", "דרוויניזם",
      "נס וסטילה", "נפוליאן", "ברון", "יומרני", "סריג",
      "זמרה", "צפתית", "מאסטרו", "דיקטטורה", "קתטר",
      "קרפדה", "הפרשת חלה", "פניצילין", "רוזמרין", "ברולטה"
    ];

    /**************************************
     * 4) HELPER: FETCH OR INIT DICTIONARY *
     **************************************/
    async function fetchOrInitDictionary(lang) {
      try {
        const docRef = doc(db, "dictionaries", lang);
        const docSnap = await getDoc(docRef);

        if (!docSnap.exists() || !docSnap.data().words || docSnap.data().words.length === 0) {
          const defaultWords = lang === "english" ? defaultEnglishWords : defaultHebrewWords;
          await setDoc(docRef, { words: defaultWords });
          return defaultWords;
        }

        return docSnap.data().words;
      } catch (error) {
        console.error(`Error fetching ${lang} dictionary:`, error);
        throw error;
      }
    }

    /*****************************************
     * 5) SHOW DICTIONARIES BUTTON HANDLER   *
     *****************************************/
    const dictionaryDisplay = document.getElementById("dictionaryDisplay");
    const showDictionariesBtn = document.getElementById("showDictionariesBtn");
    const errorMsg = document.getElementById("errorMsg");

    showDictionariesBtn.addEventListener("click", async () => {
      errorMsg.innerText = "";
      dictionaryDisplay.innerHTML = "";

      try {
        const [englishWords, hebrewWords] = await Promise.all([
          fetchOrInitDictionary("english"),
          fetchOrInitDictionary("hebrew"),
        ]);

        dictionaryDisplay.innerHTML = `
          <h3>English Dictionary</h3>
          <p>${englishWords.join(", ")}</p>
          <h3>Hebrew Dictionary</h3>
          <p>${hebrewWords.join(", ")}</p>
        `;
      } catch (error) {
        console.error("Error showing dictionaries:", error);
        errorMsg.innerText = "Failed to load dictionaries. Check console for details.";
      }
    });
  </script>
</body>
</html>
